<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Pontua√ß√£o do Cart√£o</title>
  <style>
    :root{
      --bg:#f6f7fb;
      --card:#ffffff;
      --text:#111;
      --muted:#6b7280;
      --stroke:#ececf3;
      --primary:#6d5efc;
      --danger:#ff3b5c;
      --ok:#10b981;
      --shadow:0 2px 10px rgba(25,25,25,.06);
      --r:18px;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif;background:var(--bg);color:var(--text)}
    a{color:inherit;text-decoration:none}
    .topbar{display:flex;align-items:center;justify-content:space-between;padding:16px 22px;background:#fff;border-bottom:1px solid #e9e9ee}
    .brand{font-weight:900;font-size:18px}
    .actions{display:flex;gap:10px;flex-wrap:wrap}
    .btn{display:inline-flex;align-items:center;gap:8px;padding:10px 12px;border-radius:12px;border:1px solid transparent;background:var(--primary);color:#fff;font-weight:800;cursor:pointer}
    .btn-outline{background:#fff;color:#111;border-color:#e6e6ef}
    .btn-danger{background:var(--danger)}
    .container{padding:18px 22px;max-width:1200px;margin:0 auto}
    .card{background:var(--card);border:1px solid var(--stroke);border-radius:var(--r);padding:14px;box-shadow:var(--shadow)}
    .grid{display:grid;grid-template-columns:1.1fr .9fr;gap:14px}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .muted{color:var(--muted);font-size:12px}
    .flash{padding:10px 12px;border-radius:12px;margin:10px 0;border:1px solid #eaeaf1;background:#fff}
    input,select{padding:10px 12px;border-radius:12px;border:1px solid #e6e6ef;background:#fff;outline:none}
    input{min-width:220px}
    table{width:100%;border-collapse:collapse;font-size:13px}
    th,td{padding:10px 8px;border-bottom:1px solid #eee;text-align:left;vertical-align:top}
    th{font-size:12px;color:var(--muted)}
    .pill{display:inline-flex;align-items:center;gap:6px;border:1px solid #e6e6ef;border-radius:999px;padding:6px 10px;font-size:12px;background:#fff}
    .pill strong{font-weight:900}
    .spacer{height:12px}

    /* Preview do cart√£o */
    .previewWrap{display:flex;flex-direction:column;gap:12px}
    .cc{
      border-radius:22px;
      padding:18px 18px 16px 18px;
      position:relative;
      overflow:hidden;
      border:1px solid rgba(255,255,255,.18);
      box-shadow:0 16px 40px rgba(0,0,0,.14);
      min-height:210px;
      color:#fff;
      background:
        radial-gradient(1200px 340px at 10% 0%, rgba(255,255,255,.20), transparent 60%),
        radial-gradient(900px 260px at 80% 120%, rgba(255,255,255,.18), transparent 55%),
        linear-gradient(135deg, #2b2f77, #6d5efc 60%, #a78bfa);
    }
    .cc::before{
      content:"";
      position:absolute;inset:-40px;
      background:
        radial-gradient(140px 140px at 30% 25%, rgba(255,255,255,.18), transparent 60%),
        radial-gradient(220px 220px at 70% 60%, rgba(0,0,0,.15), transparent 60%),
        linear-gradient(90deg, rgba(255,255,255,.07), transparent 55%);
      transform:rotate(-8deg);
      pointer-events:none;
    }
    .ccTop{display:flex;align-items:flex-start;justify-content:space-between;gap:10px;position:relative;z-index:2}
    .ccTitle{font-weight:900;letter-spacing:.3px}
    .ccChip{
      width:56px;height:42px;border-radius:10px;
      background:linear-gradient(135deg,#d6d3d1,#fde68a 55%,#a3a3a3);
      border:1px solid rgba(0,0,0,.15);
      box-shadow:inset 0 0 0 1px rgba(255,255,255,.12);
      position:relative;
    }
    .ccChip::after{
      content:"";
      position:absolute;left:10px;top:10px;right:10px;bottom:10px;
      border-radius:8px;
      border:1px solid rgba(0,0,0,.25);
      opacity:.45;
    }

    .ccMid{position:relative;z-index:2;margin-top:18px;display:flex;align-items:center;justify-content:space-between;gap:12px}
    .ccNumber{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:18px;letter-spacing:2px;opacity:.92}
    .ccSub{margin-top:8px;display:flex;align-items:center;justify-content:space-between;gap:12px;position:relative;z-index:2}
    .ccMeta{display:flex;flex-direction:column;gap:2px}
    .ccMeta .lbl{font-size:10px;opacity:.75}
    .ccMeta .val{font-weight:900;letter-spacing:.2px}
    .ccFib{
      position:absolute;
      left:18px;right:18px;bottom:14px;
      font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;
      font-size:12px;
      letter-spacing:1px;
      opacity:.85;
      z-index:2;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    /* Logos (SVG) */
    .logoBox{width:84px;height:30px;display:flex;align-items:center;justify-content:flex-end}
    .logoBox svg{width:84px;height:30px}
    .logoHidden{display:none !important}

    .hint{padding:10px 12px;border:1px dashed #e6e6ef;border-radius:14px;background:#fff}
    .hint b{font-weight:900}

    @media (max-width:980px){
      .grid{grid-template-columns:1fr}
      input{min-width:160px}
    }
  </style>
</head>
<body>

  <div class="topbar">
    <div class="brand">üí≥ Pontua√ß√£o do Cart√£o</div>
    <div class="actions">
      <a class="btn btn-outline" href="{{ url_for('index') }}">‚Üê Voltar</a>
      <a class="btn btn-outline" href="{{ url_for('logout') }}">Sair</a>
    </div>
  </div>

  <div class="container">

    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, msg in messages %}
          <div class="flash"><b>{{ category|upper }}</b>: {{ msg }}</div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <div class="grid">

      <!-- Form + Lista -->
      <div class="card">
        <h3 style="margin:0 0 10px 0;font-size:15px">Adicionar / Atualizar pontua√ß√£o</h3>

        <form method="post" action="{{ url_for('rewards_list') }}" class="row" id="rewardForm">
          <input name="brand" id="brandInput" placeholder="Bandeira (Visa, Mastercard, Elo...)" required>
          <input name="points_per_currency" id="ppcInput" placeholder="Pontos por moeda (ex: 1.0)" required>
          <select name="currency_unit" id="unitInput">
            <option value="BRL">por Real (BRL)</option>
            <option value="USD">por D√≥lar (USD)</option>
          </select>
          <button class="btn" type="submit">Salvar</button>
        </form>

        <div class="spacer"></div>

        <div class="hint">
          <div class="muted">
            ‚Ä¢ Se voc√™ digitar <b>Visa</b>, <b>Mastercard</b> ou <b>Elo</b>, o cart√£o aparece com a bandeira no preview. <br>
            ‚Ä¢ Qualquer outro nome: o cart√£o aparece <b>sem bandeira</b>. <br>
            ‚Ä¢ A sequ√™ncia de Fibonacci √© exibida em <b>todos</b> os cart√µes.
          </div>
        </div>

        <div class="spacer"></div>

        <h3 style="margin:0 0 10px 0;font-size:15px">Bandeiras cadastradas</h3>

        <table>
          <thead>
            <tr>
              <th>Bandeira</th>
              <th>Pontua√ß√£o</th>
              <th>Unidade</th>
              <th>Fibonacci</th>
              <th>A√ß√µes</th>
            </tr>
          </thead>
          <tbody>
            {% for r in reward_rates %}
              <tr>
                <td><span class="pill"><strong>{{ r.brand }}</strong></span></td>
                <td>{{ r.points_per_currency }}</td>
                <td>{{ r.currency_unit }}</td>
                <td class="muted" style="font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,'Courier New',monospace;">
                  1 1 2 3 5 8 13 21 34 55
                </td>
                <td>
                  <form method="post" action="{{ url_for('rewards_delete', reward_id=r.id) }}" style="display:inline">
                    <button class="btn btn-danger" type="submit">üóëÔ∏è Remover</button>
                  </form>
                </td>
              </tr>
            {% endfor %}
            {% if not reward_rates %}
              <tr><td colspan="5" class="muted">Nenhuma bandeira cadastrada ainda.</td></tr>
            {% endif %}
          </tbody>
        </table>
      </div>

      <!-- Preview do cart√£o -->
      <div class="previewWrap">
        <div class="card">
          <h3 style="margin:0 0 10px 0;font-size:15px">Preview do cart√£o</h3>

          <div class="cc" id="cardPreview">
            <div class="ccTop">
              <div>
                <div class="ccTitle">CART√ÉO ‚Ä¢ PONTOS</div>
                <div class="muted" style="color:rgba(255,255,255,.75)">A bandeira aparece quando reconhecida</div>
              </div>
              <div class="logoBox" id="logoBox">
                <!-- VISA -->
                <svg id="logoVisa" viewBox="0 0 210 75" class="logoHidden" aria-label="Visa">
                  <rect x="0" y="0" width="210" height="75" rx="16" fill="rgba(255,255,255,.10)"/>
                  <text x="20" y="52" font-size="44" font-weight="900" fill="#ffffff" font-family="system-ui, sans-serif">VISA</text>
                </svg>

                <!-- MASTERCARD -->
                <svg id="logoMaster" viewBox="0 0 210 75" class="logoHidden" aria-label="Mastercard">
                  <rect x="0" y="0" width="210" height="75" rx="16" fill="rgba(255,255,255,.10)"/>
                  <circle cx="92" cy="37" r="22" fill="#ff3b5c" opacity="0.95"/>
                  <circle cx="118" cy="37" r="22" fill="#f59e0b" opacity="0.95"/>
                  <text x="20" y="68" font-size="18" font-weight="800" fill="#ffffff" font-family="system-ui, sans-serif">mastercard</text>
                </svg>

                <!-- ELO -->
                <svg id="logoElo" viewBox="0 0 210 75" class="logoHidden" aria-label="Elo">
                  <rect x="0" y="0" width="210" height="75" rx="16" fill="rgba(255,255,255,.10)"/>
                  <text x="22" y="52" font-size="44" font-weight="900" fill="#ffffff" font-family="system-ui, sans-serif">elo</text>
                  <circle cx="160" cy="40" r="10" fill="#10b981" opacity="0.95"/>
                  <circle cx="178" cy="40" r="10" fill="#f59e0b" opacity="0.95"/>
                  <circle cx="196" cy="40" r="10" fill="#ff3b5c" opacity="0.95"/>
                </svg>
              </div>
            </div>

            <div class="ccMid">
              <div class="ccChip"></div>
              <div style="text-align:right">
                <div class="ccNumber">5326  1123  8899  0420</div>
                <div class="muted" style="color:rgba(255,255,255,.75)">
                  <span id="previewPPC">‚Äî</span> ponto(s) / <span id="previewUnit">BRL</span>
                </div>
              </div>
            </div>

            <div class="ccSub">
              <div class="ccMeta">
                <div class="lbl">Bandeira</div>
                <div class="val" id="previewBrand">‚Äî</div>
              </div>
              <div class="ccMeta" style="text-align:right">
                <div class="lbl">Validade</div>
                <div class="val">12/29</div>
              </div>
            </div>

            <!-- Fibonacci em todos -->
            <div class="ccFib" title="Sequ√™ncia de Fibonacci">
              Fibonacci: 1 1 2 3 5 8 13 21 34 55 89 144
            </div>
          </div>

          <div class="spacer"></div>

          <div class="muted">
            Dica: o preview ajuda a validar se voc√™ digitou a bandeira corretamente.
            Reconhecidas: <b>Visa</b>, <b>Mastercard</b>, <b>Elo</b>.
          </div>
        </div>
      </div>

    </div>
  </div>

  <script>
    (function(){
      const brandInput = document.getElementById('brandInput');
      const ppcInput   = document.getElementById('ppcInput');
      const unitInput  = document.getElementById('unitInput');

      const previewBrand = document.getElementById('previewBrand');
      const previewPPC   = document.getElementById('previewPPC');
      const previewUnit  = document.getElementById('previewUnit');

      const logoVisa   = document.getElementById('logoVisa');
      const logoMaster = document.getElementById('logoMaster');
      const logoElo    = document.getElementById('logoElo');

      function norm(s){
        return (s || '').toString().trim().toLowerCase();
      }

      function setLogo(brandRaw){
        const b = norm(brandRaw);

        // esconde todos
        logoVisa.classList.add('logoHidden');
        logoMaster.classList.add('logoHidden');
        logoElo.classList.add('logoHidden');

        // mostra conforme bandeira
        if (b === 'visa') {
          logoVisa.classList.remove('logoHidden');
          return;
        }
        if (b === 'mastercard' || b === 'master card') {
          logoMaster.classList.remove('logoHidden');
          return;
        }
        if (b === 'elo') {
          logoElo.classList.remove('logoHidden');
          return;
        }
        // n√£o cadastrada: fica sem logo
      }

      function refresh(){
        const brand = brandInput.value || '';
        const ppc = ppcInput.value || '‚Äî';
        const unit = unitInput.value || 'BRL';

        previewBrand.textContent = brand ? brand : '‚Äî';
        previewPPC.textContent = ppc;
        previewUnit.textContent = unit;

        setLogo(brand);
      }

      brandInput.addEventListener('input', refresh);
      ppcInput.addEventListener('input', refresh);
      unitInput.addEventListener('change', refresh);

      // inicializa
      refresh();
    })();
  </script>

</body>
</html>